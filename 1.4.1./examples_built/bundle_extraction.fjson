{"parents": [], "prev": null, "next": null, "title": "Automatic Fiber Bundle Extraction with RecoBundles", "meta": {}, "body": "<div class=\"section\" id=\"automatic-fiber-bundle-extraction-with-recobundles\">\n<span id=\"example-bundle-extraction\"></span><h1>Automatic Fiber Bundle Extraction with RecoBundles<a class=\"headerlink\" href=\"#automatic-fiber-bundle-extraction-with-recobundles\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<p>This example explains how we can use RecoBundles <a class=\"reference internal\" href=\"../../reference_cmd/dipy_slr/#garyfallidis17\" id=\"id1\"><span>[Garyfallidis17]</span></a> to extract\nbundles from tractograms.</p>\n<p>First import the necessary modules.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">numpy</span> <span class=\"k\">as</span> <span class=\"nn\">np</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.align.streamlinear</span> <span class=\"k\">import</span> <span class=\"n\">whole_brain_slr</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.data</span> <span class=\"k\">import</span> <span class=\"n\">get_two_hcp842_bundles</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.data</span> <span class=\"k\">import</span> <span class=\"p\">(</span><span class=\"n\">fetch_target_tractogram_hcp</span><span class=\"p\">,</span>\n                       <span class=\"n\">fetch_bundle_atlas_hcp842</span><span class=\"p\">,</span>\n                       <span class=\"n\">get_bundle_atlas_hcp842</span><span class=\"p\">,</span>\n                       <span class=\"n\">get_target_tractogram_hcp</span><span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.io.stateful_tractogram</span> <span class=\"k\">import</span> <span class=\"n\">Space</span><span class=\"p\">,</span> <span class=\"n\">StatefulTractogram</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.io.streamline</span> <span class=\"k\">import</span> <span class=\"n\">load_trk</span><span class=\"p\">,</span> <span class=\"n\">save_trk</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.io.utils</span> <span class=\"k\">import</span> <span class=\"n\">create_tractogram_header</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.segment.bundles</span> <span class=\"k\">import</span> <span class=\"n\">RecoBundles</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.viz</span> <span class=\"k\">import</span> <span class=\"n\">actor</span><span class=\"p\">,</span> <span class=\"n\">window</span>\n</pre></div>\n</div>\n<p>Download and read data for this tutorial</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">target_file</span><span class=\"p\">,</span> <span class=\"n\">target_folder</span> <span class=\"o\">=</span> <span class=\"n\">fetch_target_tractogram_hcp</span><span class=\"p\">()</span>\n<span class=\"n\">atlas_file</span><span class=\"p\">,</span> <span class=\"n\">atlas_folder</span> <span class=\"o\">=</span> <span class=\"n\">fetch_bundle_atlas_hcp842</span><span class=\"p\">()</span>\n\n<span class=\"n\">atlas_file</span><span class=\"p\">,</span> <span class=\"n\">all_bundles_files</span> <span class=\"o\">=</span> <span class=\"n\">get_bundle_atlas_hcp842</span><span class=\"p\">()</span>\n<span class=\"n\">target_file</span> <span class=\"o\">=</span> <span class=\"n\">get_target_tractogram_hcp</span><span class=\"p\">()</span>\n\n<span class=\"n\">sft_atlas</span> <span class=\"o\">=</span> <span class=\"n\">load_trk</span><span class=\"p\">(</span><span class=\"n\">atlas_file</span><span class=\"p\">,</span> <span class=\"s2\">&quot;same&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n<span class=\"n\">atlas</span> <span class=\"o\">=</span> <span class=\"n\">sft_atlas</span><span class=\"o\">.</span><span class=\"n\">streamlines</span>\n<span class=\"n\">atlas_header</span> <span class=\"o\">=</span> <span class=\"n\">create_tractogram_header</span><span class=\"p\">(</span><span class=\"n\">atlas_file</span><span class=\"p\">,</span>\n                                        <span class=\"o\">*</span><span class=\"n\">sft_atlas</span><span class=\"o\">.</span><span class=\"n\">space_attributes</span><span class=\"p\">)</span>\n\n<span class=\"n\">sft_target</span> <span class=\"o\">=</span> <span class=\"n\">load_trk</span><span class=\"p\">(</span><span class=\"n\">target_file</span><span class=\"p\">,</span> <span class=\"s2\">&quot;same&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n<span class=\"n\">target</span> <span class=\"o\">=</span> <span class=\"n\">sft_target</span><span class=\"o\">.</span><span class=\"n\">streamlines</span>\n<span class=\"n\">target_header</span> <span class=\"o\">=</span> <span class=\"n\">create_tractogram_header</span><span class=\"p\">(</span><span class=\"n\">target_file</span><span class=\"p\">,</span>\n                                         <span class=\"o\">*</span><span class=\"n\">sft_target</span><span class=\"o\">.</span><span class=\"n\">space_attributes</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>let\u2019s visualize atlas tractogram and target tractogram before registration</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">atlas</span><span class=\"p\">,</span> <span class=\"n\">colors</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">,</span> <span class=\"n\">colors</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">)))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;tractograms_initial.png&#39;</span><span class=\"p\">,</span> <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"figure align-center\" id=\"id4\">\n<img alt=\"../../_images/tractograms_initial.png\" src=\"../../_images/tractograms_initial.png\" />\n<p class=\"caption\"><span class=\"caption-text\">Atlas and target before registration.</span><a class=\"headerlink\" href=\"#id4\" title=\"Permalink to this image\">\u00b6</a></p>\n</div>\n<p>We will register target tractogram to model atlas\u2019 space using streamlinear\nregisteration (SLR) <a class=\"reference internal\" href=\"../../reference_cmd/dipy_slr/#garyfallidis15\" id=\"id2\"><span>[Garyfallidis15]</span></a></p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">moved</span><span class=\"p\">,</span> <span class=\"n\">transform</span><span class=\"p\">,</span> <span class=\"n\">qb_centroids1</span><span class=\"p\">,</span> <span class=\"n\">qb_centroids2</span> <span class=\"o\">=</span> <span class=\"n\">whole_brain_slr</span><span class=\"p\">(</span>\n    <span class=\"n\">atlas</span><span class=\"p\">,</span> <span class=\"n\">target</span><span class=\"p\">,</span> <span class=\"n\">x0</span><span class=\"o\">=</span><span class=\"s1\">&#39;affine&#39;</span><span class=\"p\">,</span> <span class=\"n\">verbose</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">progressive</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span>\n    <span class=\"n\">rng</span><span class=\"o\">=</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">random</span><span class=\"o\">.</span><span class=\"n\">RandomState</span><span class=\"p\">(</span><span class=\"mi\">1984</span><span class=\"p\">))</span>\n</pre></div>\n</div>\n<p>We save the transform generated in this registration, so that we can use\nit in the bundle profiles example</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">save</span><span class=\"p\">(</span><span class=\"s2\">&quot;slr_transform.npy&quot;</span><span class=\"p\">,</span> <span class=\"n\">transform</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>let\u2019s visualize atlas tractogram and target tractogram after registration</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">atlas</span><span class=\"p\">,</span> <span class=\"n\">colors</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">moved</span><span class=\"p\">,</span> <span class=\"n\">colors</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">0</span><span class=\"p\">)))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;tractograms_after_registration.png&#39;</span><span class=\"p\">,</span>\n              <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"figure align-center\" id=\"id5\">\n<img alt=\"../../_images/tractograms_after_registration.png\" src=\"../../_images/tractograms_after_registration.png\" />\n<p class=\"caption\"><span class=\"caption-text\">Atlas and target after registration.</span><a class=\"headerlink\" href=\"#id5\" title=\"Permalink to this image\">\u00b6</a></p>\n</div>\n<p>Extracting bundles using RecoBundles <a class=\"reference internal\" href=\"../../reference_cmd/dipy_slr/#garyfallidis17\" id=\"id3\"><span>[Garyfallidis17]</span></a></p>\n<p>RecoBundles requires a model (reference) bundle and tries to extract similar\nlooking bundle from the input tractogram. There are some key parameters that\nusers can set as per requirements. Here are the key threshold parameters\nmeasured in millimeters and their function in Recobundles:</p>\n<blockquote>\n<div><ul class=\"simple\">\n<li><p>model_clust_thr : It will use QuickBundles to get the centroids of the</p></li>\n</ul>\n<p>model bundle and work with centroids instead of all streamlines. This helps\nto make RecoBundles faster. The larger the value of threshold fewer\ncentroids will be there and smaller the threshold value, more centroids\nwill be tthere. If you prefer to use all the streamlines of the model\nbundle, you can set this threshold to 0.01 mm.\nRecommended range of the model_clust_thr is 0.01 - 3.0 mm.</p>\n<ul class=\"simple\">\n<li><p>reduction_thr : This threshold will be used to reduce the search space</p></li>\n</ul>\n<p>for finding the streamlines that match model bundle streamlines in shape.\nInstead of looking at the entire tractogram, now we will be looking at\nneighboring region of a model bundle in the tractogram. Increase the\nthreshold to increase the search space.\nRecommended range of the reduction_thr is 15 - 30 mm.</p>\n<ul class=\"simple\">\n<li><p>pruning_thr : This threshold will filter the streamlines for which the</p></li>\n</ul>\n<p>distance to the model bundle is greater than the pruning_thr.\nThis serves to filter the neighborhood area (search space) to get\nstreamlines that are like the model bundle.\nRecommended range of the pruning_thr is 8 - 12 mm.</p>\n<ul class=\"simple\">\n<li><p>reduction_distance and pruning_distance : Distance method used internally.</p></li>\n</ul>\n<p>Minimum Diferect Flip distance (mdf) or Mean Average Minimum (mam).\nDefault is set to mdf.</p>\n<ul class=\"simple\">\n<li><p>slr : If slr flag is set to True, local registration of model bundle with</p></li>\n</ul>\n<p>neighbouring area will be performed. Default and recommended is True.</p>\n</div></blockquote>\n<p>Read Arcuate Fasciculus Left and Corticospinal Tract Left bundles from already\nfetched atlas data to use them as model bundle. Let\u2019s visualize the\nArcuate Fasciculus Left model bundle.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">model_af_l_file</span><span class=\"p\">,</span> <span class=\"n\">model_cst_l_file</span> <span class=\"o\">=</span> <span class=\"n\">get_two_hcp842_bundles</span><span class=\"p\">()</span>\n<span class=\"n\">sft_af_l</span> <span class=\"o\">=</span> <span class=\"n\">load_trk</span><span class=\"p\">(</span><span class=\"n\">model_af_l_file</span><span class=\"p\">,</span> <span class=\"s2\">&quot;same&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n<span class=\"n\">model_af_l</span> <span class=\"o\">=</span> <span class=\"n\">sft_af_l</span><span class=\"o\">.</span><span class=\"n\">streamlines</span>\n\n<span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">model_af_l</span><span class=\"p\">))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">set_camera</span><span class=\"p\">(</span><span class=\"n\">focal_point</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">18.17281532</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">19.55606842</span><span class=\"p\">,</span> <span class=\"mf\">6.92485857</span><span class=\"p\">),</span>\n                 <span class=\"n\">position</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">360.11</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">30.46</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">40.44</span><span class=\"p\">),</span>\n                 <span class=\"n\">view_up</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">0.03</span><span class=\"p\">,</span> <span class=\"mf\">0.028</span><span class=\"p\">,</span> <span class=\"mf\">0.89</span><span class=\"p\">))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;AF_L_model_bundle.png&#39;</span><span class=\"p\">,</span>\n              <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"figure align-center\" id=\"id6\">\n<img alt=\"../../_images/AF_L_model_bundle.png\" src=\"../../_images/AF_L_model_bundle.png\" />\n<p class=\"caption\"><span class=\"caption-text\">Model Arcuate Fasciculus Left bundle</span><a class=\"headerlink\" href=\"#id6\" title=\"Permalink to this image\">\u00b6</a></p>\n</div>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">rb</span> <span class=\"o\">=</span> <span class=\"n\">RecoBundles</span><span class=\"p\">(</span><span class=\"n\">moved</span><span class=\"p\">,</span> <span class=\"n\">verbose</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">,</span> <span class=\"n\">rng</span><span class=\"o\">=</span><span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">random</span><span class=\"o\">.</span><span class=\"n\">RandomState</span><span class=\"p\">(</span><span class=\"mi\">2001</span><span class=\"p\">))</span>\n\n<span class=\"n\">recognized_af_l</span><span class=\"p\">,</span> <span class=\"n\">af_l_labels</span> <span class=\"o\">=</span> <span class=\"n\">rb</span><span class=\"o\">.</span><span class=\"n\">recognize</span><span class=\"p\">(</span><span class=\"n\">model_bundle</span><span class=\"o\">=</span><span class=\"n\">model_af_l</span><span class=\"p\">,</span>\n                                            <span class=\"n\">model_clust_thr</span><span class=\"o\">=</span><span class=\"mf\">0.1</span><span class=\"p\">,</span>\n                                            <span class=\"n\">reduction_thr</span><span class=\"o\">=</span><span class=\"mi\">15</span><span class=\"p\">,</span>\n                                            <span class=\"n\">pruning_thr</span><span class=\"o\">=</span><span class=\"mi\">7</span><span class=\"p\">,</span>\n                                            <span class=\"n\">reduction_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                            <span class=\"n\">pruning_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                            <span class=\"n\">slr</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>let\u2019s visualize extracted Arcuate Fasciculus Left bundle</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">recognized_af_l</span><span class=\"p\">))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">set_camera</span><span class=\"p\">(</span><span class=\"n\">focal_point</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">18.17281532</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">19.55606842</span><span class=\"p\">,</span> <span class=\"mf\">6.92485857</span><span class=\"p\">),</span>\n                 <span class=\"n\">position</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">360.11</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">30.46</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">40.44</span><span class=\"p\">),</span>\n                 <span class=\"n\">view_up</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">0.03</span><span class=\"p\">,</span> <span class=\"mf\">0.028</span><span class=\"p\">,</span> <span class=\"mf\">0.89</span><span class=\"p\">))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;AF_L_recognized_bundle.png&#39;</span><span class=\"p\">,</span>\n              <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"figure align-center\" id=\"id7\">\n<img alt=\"../../_images/AF_L_recognized_bundle.png\" src=\"../../_images/AF_L_recognized_bundle.png\" />\n<p class=\"caption\"><span class=\"caption-text\">Extracted Arcuate Fasciculus Left bundle</span><a class=\"headerlink\" href=\"#id7\" title=\"Permalink to this image\">\u00b6</a></p>\n</div>\n<p>Save the bundle as a trk file. Let\u2019s save the recognized bundle in the\ncommon space (atlas space), in this case, MNI space.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_af_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">recognized_af_l</span><span class=\"p\">,</span> <span class=\"n\">atlas_header</span><span class=\"p\">,</span>\n                               <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_af_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;AF_L_rec_1.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Let\u2019s save the recognized bundle in the original space of the subject anatomy.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_af_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">[</span><span class=\"n\">af_l_labels</span><span class=\"p\">],</span> <span class=\"n\">target_header</span><span class=\"p\">,</span>\n                               <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_af_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;AF_L_org_1.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Now, let\u2019s increase the reduction_thr and pruning_thr values.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">recognized_af_l</span><span class=\"p\">,</span> <span class=\"n\">af_l_labels</span> <span class=\"o\">=</span> <span class=\"n\">rb</span><span class=\"o\">.</span><span class=\"n\">recognize</span><span class=\"p\">(</span><span class=\"n\">model_bundle</span><span class=\"o\">=</span><span class=\"n\">model_af_l</span><span class=\"p\">,</span>\n                                            <span class=\"n\">model_clust_thr</span><span class=\"o\">=</span><span class=\"mf\">0.1</span><span class=\"p\">,</span>\n                                            <span class=\"n\">reduction_thr</span><span class=\"o\">=</span><span class=\"mi\">20</span><span class=\"p\">,</span>\n                                            <span class=\"n\">pruning_thr</span><span class=\"o\">=</span><span class=\"mi\">10</span><span class=\"p\">,</span>\n                                            <span class=\"n\">reduction_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                            <span class=\"n\">pruning_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                            <span class=\"n\">slr</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>let\u2019s visualize extracted Arcuate Fasciculus Left bundle.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">recognized_af_l</span><span class=\"p\">))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">set_camera</span><span class=\"p\">(</span><span class=\"n\">focal_point</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">18.17281532</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">19.55606842</span><span class=\"p\">,</span> <span class=\"mf\">6.92485857</span><span class=\"p\">),</span>\n                 <span class=\"n\">position</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">360.11</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">30.46</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">40.44</span><span class=\"p\">),</span>\n                 <span class=\"n\">view_up</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">0.03</span><span class=\"p\">,</span> <span class=\"mf\">0.028</span><span class=\"p\">,</span> <span class=\"mf\">0.89</span><span class=\"p\">))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;AF_L_recognized_bundle2.png&#39;</span><span class=\"p\">,</span>\n              <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"figure align-center\" id=\"id8\">\n<img alt=\"../../_images/AF_L_recognized_bundle2.png\" src=\"../../_images/AF_L_recognized_bundle2.png\" />\n<p class=\"caption\"><span class=\"caption-text\">Extracted Arcuate Fasciculus Left bundle</span><a class=\"headerlink\" href=\"#id8\" title=\"Permalink to this image\">\u00b6</a></p>\n</div>\n<p>Save the bundle as a trk file. Let\u2019s save the recognized bundle in the\ncommon space (atlas space), in this case, MNI space.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_af_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">recognized_af_l</span><span class=\"p\">,</span> <span class=\"n\">atlas_header</span><span class=\"p\">,</span>\n                               <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_af_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;AF_L_rec_2.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Let\u2019s save the recognized bundle in the original space of the subject anatomy.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_af_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">[</span><span class=\"n\">af_l_labels</span><span class=\"p\">],</span> <span class=\"n\">target_header</span><span class=\"p\">,</span>\n                               <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_af_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;AF_L_org_2.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Now, let\u2019s increase the reduction_thr and pruning_thr values further.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">recognized_af_l</span><span class=\"p\">,</span> <span class=\"n\">af_l_labels</span> <span class=\"o\">=</span> <span class=\"n\">rb</span><span class=\"o\">.</span><span class=\"n\">recognize</span><span class=\"p\">(</span><span class=\"n\">model_bundle</span><span class=\"o\">=</span><span class=\"n\">model_af_l</span><span class=\"p\">,</span>\n                                            <span class=\"n\">model_clust_thr</span><span class=\"o\">=</span><span class=\"mf\">0.1</span><span class=\"p\">,</span>\n                                            <span class=\"n\">reduction_thr</span><span class=\"o\">=</span><span class=\"mi\">25</span><span class=\"p\">,</span>\n                                            <span class=\"n\">pruning_thr</span><span class=\"o\">=</span><span class=\"mi\">12</span><span class=\"p\">,</span>\n                                            <span class=\"n\">reduction_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                            <span class=\"n\">pruning_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                            <span class=\"n\">slr</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>let\u2019s visualize extracted Arcuate Fasciculus Left bundle.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">recognized_af_l</span><span class=\"p\">))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">set_camera</span><span class=\"p\">(</span><span class=\"n\">focal_point</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">18.17281532</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">19.55606842</span><span class=\"p\">,</span> <span class=\"mf\">6.92485857</span><span class=\"p\">),</span>\n                 <span class=\"n\">position</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">360.11</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">30.46</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">40.44</span><span class=\"p\">),</span>\n                 <span class=\"n\">view_up</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">0.03</span><span class=\"p\">,</span> <span class=\"mf\">0.028</span><span class=\"p\">,</span> <span class=\"mf\">0.89</span><span class=\"p\">))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;AF_L_recognized_bundle3.png&#39;</span><span class=\"p\">,</span>\n              <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"figure align-center\" id=\"id9\">\n<img alt=\"../../_images/AF_L_recognized_bundle3.png\" src=\"../../_images/AF_L_recognized_bundle3.png\" />\n<p class=\"caption\"><span class=\"caption-text\">Extracted Arcuate Fasciculus Left bundle</span><a class=\"headerlink\" href=\"#id9\" title=\"Permalink to this image\">\u00b6</a></p>\n</div>\n<p>Save the bundle as a trk file. Let\u2019s save the recognized bundle in the\ncommon space (atlas space), in this case, MNI space.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_af_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">recognized_af_l</span><span class=\"p\">,</span> <span class=\"n\">atlas_header</span><span class=\"p\">,</span>\n                               <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_af_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;AF_L_rec_3.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Let\u2019s save the recognized bundle in the original space of the subject anatomy.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_af_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">[</span><span class=\"n\">af_l_labels</span><span class=\"p\">],</span> <span class=\"n\">target_header</span><span class=\"p\">,</span>\n                               <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_af_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;AF_L_org_3.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Let\u2019s apply auto-calibrated RecoBundles on the output of standard RecoBundles.\nThis step will filter out the outlier streamlines. This time, the RecoBundles\u2019\nextracted bundle will serve as a model bundle. As a rule of thumb, provide\nlarger threshold values in standard RecoBundles function and smaller values in\nthe auto-calibrated RecoBundles (refinement) step.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">r_recognized_af_l</span><span class=\"p\">,</span> <span class=\"n\">r_af_l_labels</span> <span class=\"o\">=</span> <span class=\"n\">rb</span><span class=\"o\">.</span><span class=\"n\">refine</span><span class=\"p\">(</span><span class=\"n\">model_bundle</span><span class=\"o\">=</span><span class=\"n\">model_af_l</span><span class=\"p\">,</span>\n                                             <span class=\"n\">pruned_streamlines</span><span class=\"o\">=</span><span class=\"n\">recognized_af_l</span><span class=\"p\">,</span>\n                                             <span class=\"n\">model_clust_thr</span><span class=\"o\">=</span><span class=\"mf\">0.1</span><span class=\"p\">,</span>\n                                             <span class=\"n\">reduction_thr</span><span class=\"o\">=</span><span class=\"mi\">15</span><span class=\"p\">,</span>\n                                             <span class=\"n\">pruning_thr</span><span class=\"o\">=</span><span class=\"mi\">6</span><span class=\"p\">,</span>\n                                             <span class=\"n\">reduction_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                             <span class=\"n\">pruning_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                             <span class=\"n\">slr</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>let\u2019s visualize extracted refined Arcuate Fasciculus Left bundle.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">r_recognized_af_l</span><span class=\"p\">))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">set_camera</span><span class=\"p\">(</span><span class=\"n\">focal_point</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">18.17281532</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">19.55606842</span><span class=\"p\">,</span> <span class=\"mf\">6.92485857</span><span class=\"p\">),</span>\n                 <span class=\"n\">position</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">360.11</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">30.46</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">40.44</span><span class=\"p\">),</span>\n                 <span class=\"n\">view_up</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">0.03</span><span class=\"p\">,</span> <span class=\"mf\">0.028</span><span class=\"p\">,</span> <span class=\"mf\">0.89</span><span class=\"p\">))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;AF_L_refine_recognized_bundle.png&#39;</span><span class=\"p\">,</span>\n              <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"figure align-center\" id=\"id10\">\n<img alt=\"../../_images/AF_L_refine_recognized_bundle.png\" src=\"../../_images/AF_L_refine_recognized_bundle.png\" />\n<p class=\"caption\"><span class=\"caption-text\">Extracted Arcuate Fasciculus Left bundle</span><a class=\"headerlink\" href=\"#id10\" title=\"Permalink to this image\">\u00b6</a></p>\n</div>\n<p>Save the bundle as a trk file. Let\u2019s save the recognized bundle in the\ncommon space (atlas space), in this case, MNI space.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_af_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">r_recognized_af_l</span><span class=\"p\">,</span> <span class=\"n\">atlas_header</span><span class=\"p\">,</span>\n                               <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_af_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;AF_L_rec_refine.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Let\u2019s save the recognized bundle in the original space of the subject anatomy.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_af_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">[</span><span class=\"n\">r_af_l_labels</span><span class=\"p\">],</span> <span class=\"n\">target_header</span><span class=\"p\">,</span>\n                               <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_af_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;AF_L_org_refine.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Let\u2019s load Corticospinal Tract Left model bundle and visualize it.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">sft_cst_l</span> <span class=\"o\">=</span> <span class=\"n\">load_trk</span><span class=\"p\">(</span><span class=\"n\">model_cst_l_file</span><span class=\"p\">,</span> <span class=\"s2\">&quot;same&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n<span class=\"n\">model_cst_l</span> <span class=\"o\">=</span> <span class=\"n\">sft_cst_l</span><span class=\"o\">.</span><span class=\"n\">streamlines</span>\n\n<span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">model_cst_l</span><span class=\"p\">))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">set_camera</span><span class=\"p\">(</span><span class=\"n\">focal_point</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">18.17281532</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">19.55606842</span><span class=\"p\">,</span> <span class=\"mf\">6.92485857</span><span class=\"p\">),</span>\n                 <span class=\"n\">position</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">360.11</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">30.46</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">40.44</span><span class=\"p\">),</span>\n                 <span class=\"n\">view_up</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">0.03</span><span class=\"p\">,</span> <span class=\"mf\">0.028</span><span class=\"p\">,</span> <span class=\"mf\">0.89</span><span class=\"p\">))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;CST_L_model_bundle.png&#39;</span><span class=\"p\">,</span>\n              <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"figure align-center\" id=\"id11\">\n<img alt=\"../../_images/CST_L_model_bundle.png\" src=\"../../_images/CST_L_model_bundle.png\" />\n<p class=\"caption\"><span class=\"caption-text\">The Corticospinal tract model bundle</span><a class=\"headerlink\" href=\"#id11\" title=\"Permalink to this image\">\u00b6</a></p>\n</div>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">recognized_cst_l</span><span class=\"p\">,</span> <span class=\"n\">cst_l_labels</span> <span class=\"o\">=</span> <span class=\"n\">rb</span><span class=\"o\">.</span><span class=\"n\">recognize</span><span class=\"p\">(</span><span class=\"n\">model_bundle</span><span class=\"o\">=</span><span class=\"n\">model_cst_l</span><span class=\"p\">,</span>\n                                              <span class=\"n\">model_clust_thr</span><span class=\"o\">=</span><span class=\"mf\">0.1</span><span class=\"p\">,</span>\n                                              <span class=\"n\">reduction_thr</span><span class=\"o\">=</span><span class=\"mi\">15</span><span class=\"p\">,</span>\n                                              <span class=\"n\">pruning_thr</span><span class=\"o\">=</span><span class=\"mi\">7</span><span class=\"p\">,</span>\n                                              <span class=\"n\">reduction_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                              <span class=\"n\">pruning_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                              <span class=\"n\">slr</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>let\u2019s visualize extracted Corticospinal tract Left bundle</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">recognized_cst_l</span><span class=\"p\">))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">set_camera</span><span class=\"p\">(</span><span class=\"n\">focal_point</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">18.17281532</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">19.55606842</span><span class=\"p\">,</span> <span class=\"mf\">6.92485857</span><span class=\"p\">),</span>\n                 <span class=\"n\">position</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">360.11</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">30.46</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">40.44</span><span class=\"p\">),</span>\n                 <span class=\"n\">view_up</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">0.03</span><span class=\"p\">,</span> <span class=\"mf\">0.028</span><span class=\"p\">,</span> <span class=\"mf\">0.89</span><span class=\"p\">))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;CST_L_recognized_bundle.png&#39;</span><span class=\"p\">,</span>\n              <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"figure align-center\" id=\"id12\">\n<img alt=\"../../_images/CST_L_recognized_bundle.png\" src=\"../../_images/CST_L_recognized_bundle.png\" />\n<p class=\"caption\"><span class=\"caption-text\">Extracted Corticospinal tract Left bundle</span><a class=\"headerlink\" href=\"#id12\" title=\"Permalink to this image\">\u00b6</a></p>\n</div>\n<p>Save the bundle as a trk file. Let\u2019s save the recognized bundle in the\ncommon space (atlas space), in this case, MNI space.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_cst_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">recognized_cst_l</span><span class=\"p\">,</span> <span class=\"n\">atlas_header</span><span class=\"p\">,</span>\n                                <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_cst_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;CST_L_rec_1.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Let\u2019s save the recognized bundle in the original space of the subject anatomy.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_cst_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">[</span><span class=\"n\">cst_l_labels</span><span class=\"p\">],</span> <span class=\"n\">target_header</span><span class=\"p\">,</span>\n                                <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_cst_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;CST_L_org_1.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Now, let\u2019s increase the reduction_thr and pruning_thr values.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">recognized_cst_l</span><span class=\"p\">,</span> <span class=\"n\">cst_l_labels</span> <span class=\"o\">=</span> <span class=\"n\">rb</span><span class=\"o\">.</span><span class=\"n\">recognize</span><span class=\"p\">(</span><span class=\"n\">model_bundle</span><span class=\"o\">=</span><span class=\"n\">model_cst_l</span><span class=\"p\">,</span>\n                                              <span class=\"n\">model_clust_thr</span><span class=\"o\">=</span><span class=\"mf\">0.1</span><span class=\"p\">,</span>\n                                              <span class=\"n\">reduction_thr</span><span class=\"o\">=</span><span class=\"mi\">20</span><span class=\"p\">,</span>\n                                              <span class=\"n\">pruning_thr</span><span class=\"o\">=</span><span class=\"mi\">10</span><span class=\"p\">,</span>\n                                              <span class=\"n\">reduction_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                              <span class=\"n\">pruning_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                              <span class=\"n\">slr</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>let\u2019s visualize extracted Corticospinal tract Left bundle.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">recognized_cst_l</span><span class=\"p\">))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">set_camera</span><span class=\"p\">(</span><span class=\"n\">focal_point</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">18.17281532</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">19.55606842</span><span class=\"p\">,</span> <span class=\"mf\">6.92485857</span><span class=\"p\">),</span>\n                 <span class=\"n\">position</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">360.11</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">30.46</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">40.44</span><span class=\"p\">),</span>\n                 <span class=\"n\">view_up</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">0.03</span><span class=\"p\">,</span> <span class=\"mf\">0.028</span><span class=\"p\">,</span> <span class=\"mf\">0.89</span><span class=\"p\">))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;CST_L_recognized_bundle2.png&#39;</span><span class=\"p\">,</span>\n              <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"figure align-center\" id=\"id13\">\n<img alt=\"../../_images/CST_L_recognized_bundle2.png\" src=\"../../_images/CST_L_recognized_bundle2.png\" />\n<p class=\"caption\"><span class=\"caption-text\">Extracted Corticospinal tract Left bundle</span><a class=\"headerlink\" href=\"#id13\" title=\"Permalink to this image\">\u00b6</a></p>\n</div>\n<p>Save the bundle as a trk file. Let\u2019s save the recognized bundle in the\ncommon space (atlas space), in this case, MNI space.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_cst_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">recognized_cst_l</span><span class=\"p\">,</span> <span class=\"n\">atlas_header</span><span class=\"p\">,</span>\n                                <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_cst_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;CST_L_rec_2.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Let\u2019s save the recognized bundle in the original space of the subject anatomy.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_cst_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">[</span><span class=\"n\">cst_l_labels</span><span class=\"p\">],</span> <span class=\"n\">target_header</span><span class=\"p\">,</span>\n                                <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_cst_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;CST_L_org_2.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Now, let\u2019s increase the reduction_thr and pruning_thr values further.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">recognized_cst_l</span><span class=\"p\">,</span> <span class=\"n\">cst_l_labels</span> <span class=\"o\">=</span> <span class=\"n\">rb</span><span class=\"o\">.</span><span class=\"n\">recognize</span><span class=\"p\">(</span><span class=\"n\">model_bundle</span><span class=\"o\">=</span><span class=\"n\">model_cst_l</span><span class=\"p\">,</span>\n                                              <span class=\"n\">model_clust_thr</span><span class=\"o\">=</span><span class=\"mf\">0.1</span><span class=\"p\">,</span>\n                                              <span class=\"n\">reduction_thr</span><span class=\"o\">=</span><span class=\"mi\">25</span><span class=\"p\">,</span>\n                                              <span class=\"n\">pruning_thr</span><span class=\"o\">=</span><span class=\"mi\">12</span><span class=\"p\">,</span>\n                                              <span class=\"n\">reduction_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                              <span class=\"n\">pruning_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                              <span class=\"n\">slr</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>let\u2019s visualize extracted Corticospinal tract Left bundle.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">recognized_cst_l</span><span class=\"p\">))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">set_camera</span><span class=\"p\">(</span><span class=\"n\">focal_point</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">18.17281532</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">19.55606842</span><span class=\"p\">,</span> <span class=\"mf\">6.92485857</span><span class=\"p\">),</span>\n                 <span class=\"n\">position</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">360.11</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">30.46</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">40.44</span><span class=\"p\">),</span>\n                 <span class=\"n\">view_up</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">0.03</span><span class=\"p\">,</span> <span class=\"mf\">0.028</span><span class=\"p\">,</span> <span class=\"mf\">0.89</span><span class=\"p\">))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;CST_L_recognized_bundle3.png&#39;</span><span class=\"p\">,</span>\n              <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"figure align-center\" id=\"id14\">\n<img alt=\"../../_images/CST_L_recognized_bundle3.png\" src=\"../../_images/CST_L_recognized_bundle3.png\" />\n<p class=\"caption\"><span class=\"caption-text\">Extracted Corticospinal tract Left bundle</span><a class=\"headerlink\" href=\"#id14\" title=\"Permalink to this image\">\u00b6</a></p>\n</div>\n<p>Save the bundle as a trk file. Let\u2019s save the recognized bundle in the\ncommon space (atlas space), in this case, MNI space.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_cst_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">recognized_cst_l</span><span class=\"p\">,</span> <span class=\"n\">atlas_header</span><span class=\"p\">,</span>\n                                <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_cst_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;CST_L_rec_3.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Let\u2019s save the recognized bundle in the original space of the subject anatomy.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_cst_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">[</span><span class=\"n\">cst_l_labels</span><span class=\"p\">],</span> <span class=\"n\">target_header</span><span class=\"p\">,</span>\n                                <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_cst_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;CST_L_org_3.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Let\u2019s apply auto-calibrated RecoBundles on the output of standard RecoBundles.\nThis step will filter out the outlier streamlines. This time, the RecoBundles\u2019\nextracted bundle will serve as a model bundle. As a rule of thumb, provide\nlarger threshold values in standard RecoBundles function and smaller values in\nthe auto-calibrated RecoBundles (refinement) step.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">r_recognized_cst_l</span><span class=\"p\">,</span> <span class=\"n\">r_cst_l_labels</span> <span class=\"o\">=</span> <span class=\"n\">rb</span><span class=\"o\">.</span><span class=\"n\">refine</span><span class=\"p\">(</span>\n                                     <span class=\"n\">model_bundle</span><span class=\"o\">=</span><span class=\"n\">model_cst_l</span><span class=\"p\">,</span>\n                                     <span class=\"n\">pruned_streamlines</span><span class=\"o\">=</span><span class=\"n\">recognized_cst_l</span><span class=\"p\">,</span>\n                                     <span class=\"n\">model_clust_thr</span><span class=\"o\">=</span><span class=\"mf\">0.1</span><span class=\"p\">,</span>\n                                     <span class=\"n\">reduction_thr</span><span class=\"o\">=</span><span class=\"mi\">15</span><span class=\"p\">,</span>\n                                     <span class=\"n\">pruning_thr</span><span class=\"o\">=</span><span class=\"mi\">6</span><span class=\"p\">,</span>\n                                     <span class=\"n\">reduction_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                     <span class=\"n\">pruning_distance</span><span class=\"o\">=</span><span class=\"s1\">&#39;mdf&#39;</span><span class=\"p\">,</span>\n                                     <span class=\"n\">slr</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>let\u2019s visualize extracted refined Corticospinal tract Left bundle.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">SetBackground</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">r_recognized_cst_l</span><span class=\"p\">))</span>\n<span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">set_camera</span><span class=\"p\">(</span><span class=\"n\">focal_point</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">18.17281532</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">19.55606842</span><span class=\"p\">,</span> <span class=\"mf\">6.92485857</span><span class=\"p\">),</span>\n                 <span class=\"n\">position</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">360.11</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">30.46</span><span class=\"p\">,</span> <span class=\"o\">-</span><span class=\"mf\">40.44</span><span class=\"p\">),</span>\n                 <span class=\"n\">view_up</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"o\">-</span><span class=\"mf\">0.03</span><span class=\"p\">,</span> <span class=\"mf\">0.028</span><span class=\"p\">,</span> <span class=\"mf\">0.89</span><span class=\"p\">))</span>\n<span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;CST_L_refine_recognized_bundle.png&#39;</span><span class=\"p\">,</span>\n              <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">600</span><span class=\"p\">,</span> <span class=\"mi\">600</span><span class=\"p\">))</span>\n<span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"figure align-center\" id=\"id15\">\n<img alt=\"../../_images/CST_L_refine_recognized_bundle.png\" src=\"../../_images/CST_L_refine_recognized_bundle.png\" />\n<p class=\"caption\"><span class=\"caption-text\">Extracted refined Corticospinal tract Left bundle</span><a class=\"headerlink\" href=\"#id15\" title=\"Permalink to this image\">\u00b6</a></p>\n</div>\n<p>Save the bundle as a trk file. Let\u2019s save the recognized bundle in the\ncommon space (atlas space), in this case, MNI space.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_cst_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">r_recognized_cst_l</span><span class=\"p\">,</span> <span class=\"n\">atlas_header</span><span class=\"p\">,</span>\n                                <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_cst_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;CST_L_rec_refine.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>Let\u2019s save the recognized bundle in the original space of the subject anatomy.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">reco_cst_l</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">target</span><span class=\"p\">[</span><span class=\"n\">r_cst_l_labels</span><span class=\"p\">],</span> <span class=\"n\">target_header</span><span class=\"p\">,</span>\n                                <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">reco_cst_l</span><span class=\"p\">,</span> <span class=\"s2\">&quot;CST_L_org_refine.trk&quot;</span><span class=\"p\">,</span> <span class=\"n\">bbox_valid_check</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<p>This example shows how changing different threshold parameters can change the\noutput. It is up to the user to decide what is the desired output and select\nparameters accordingly.</p>\n<div class=\"section\" id=\"references\">\n<h2>References<a class=\"headerlink\" href=\"#references\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<dl class=\"citation\">\n<dt class=\"label\" id=\"garyfallidis17\"><span class=\"brackets\">Garyfallidis17</span><span class=\"fn-backref\">(<a href=\"#id1\">1</a>,<a href=\"#id3\">2</a>)</span></dt>\n<dd><p>Garyfallidis et al. Recognition of white matter\nbundles using local and global streamline-based registration\nand clustering, Neuroimage, 2017.</p>\n</dd>\n<dt class=\"label\" id=\"chandio2020\"><span class=\"brackets\">Chandio2020</span></dt>\n<dd><p>Chandio, B.Q., Risacher, S.L., Pestilli, F.,\nBullock, D., Yeh, FC., Koudoro, S., Rokem, A., Harezlak, J., and\nGaryfallidis, E. Bundle analytics, a computational framework for\ninvestigating the shapes and profiles of brain pathways across\npopulations. Sci Rep 10, 17149 (2020)</p>\n</dd>\n</dl>\n<div class=\"admonition-example-source-code admonition\">\n<p class=\"admonition-title\">Example source code</p>\n<p>You can download <a class=\"reference download internal\" download=\"\" href=\"../../_downloads/63ec884db107e3ccff940753c2a9cb4b/bundle_extraction.py\"><code class=\"xref download docutils literal notranslate\"><span class=\"pre\">the</span> <span class=\"pre\">full</span> <span class=\"pre\">source</span> <span class=\"pre\">code</span> <span class=\"pre\">of</span> <span class=\"pre\">this</span> <span class=\"pre\">example</span></code></a>. This same script is also included in the dipy source distribution under the <code class=\"file docutils literal notranslate\"><span class=\"pre\">doc/examples/</span></code> directory.</p>\n</div>\n</div>\n</div>\n", "metatags": "", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"]], "sourcename": "examples_built/bundle_extraction.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Automatic Fiber Bundle Extraction with RecoBundles</a><ul>\n<li><a class=\"reference internal\" href=\"#references\">References</a></li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".rst", "current_page_name": "examples_built/bundle_extraction", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}