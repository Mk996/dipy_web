{"parents": [], "prev": null, "next": null, "title": "Using Various Stopping Criterion for Tractography", "meta": {}, "body": "<div class=\"sphx-glr-download-link-note admonition note\">\n<p class=\"admonition-title\">Note</p>\n<p>Click <a class=\"reference internal\" href=\"#sphx-glr-download-examples-built-fiber-tracking-tracking-stopping-criterion-py\"><span class=\"std std-ref\">here</span></a>     to download the full example code</p>\n</div>\n<div class=\"sphx-glr-example-title section\" id=\"using-various-stopping-criterion-for-tractography\">\n<span id=\"sphx-glr-examples-built-fiber-tracking-tracking-stopping-criterion-py\"></span><h1>Using Various Stopping Criterion for Tractography<a class=\"headerlink\" href=\"#using-various-stopping-criterion-for-tractography\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<p>The stopping criterion determines if the tracking stops or continues at each\ntracking position. The tracking stops when it reaches an ending region\n(e.g. low FA, gray matter or corticospinal fluid regions) or exits the image\nboundaries. The tracking also stops if the direction getter has no direction\nto follow.</p>\n<p>Each stopping criterion determines if the stopping is \u2018valid\u2019 or\n\u2018invalid\u2019. A streamline is \u2018valid\u2019 when the stopping criterion determines if\nthe streamline stops in a position classified as \u2018ENDPOINT\u2019 or \u2018OUTSIDEIMAGE\u2019.\nA streamline is \u2018invalid\u2019 when it stops in a position classified as\n\u2018TRACKPOINT\u2019 or \u2018INVALIDPOINT\u2019. These conditions are described below. The\n\u2018LocalTracking\u2019 generator can be set to output all generated streamlines\nor only the \u2018valid\u2019 ones. See Girard et al. (2004) <a class=\"reference internal\" href=\"../../tracking_stopping_criterion/#girard2014\" id=\"id1\"><span>[Girard2014]</span></a> and Smith et\nal.(2012) <a class=\"reference internal\" href=\"../../tracking_stopping_criterion/#smith2012\" id=\"id2\"><span>[Smith2012]</span></a> for more details on these methods.</p>\n<p>This example is an extension of the\n<a class=\"reference internal\" href=\"../../tracking_deterministic/#example-tracking-deterministic\"><span class=\"std std-ref\">An introduction to the Deterministic Maximum Direction Getter</span></a> example. We begin by loading the\ndata, creating a seeding mask from white matter voxels of the corpus callosum,\nfitting a Constrained Spherical Deconvolution (CSD) reconstruction\nmodel and creating the maximum deterministic direction getter.</p>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"kn\">import</span> <span class=\"nn\">matplotlib.pyplot</span> <span class=\"k\">as</span> <span class=\"nn\">plt</span>\n<span class=\"kn\">import</span> <span class=\"nn\">numpy</span> <span class=\"k\">as</span> <span class=\"nn\">np</span>\n\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.core.gradients</span> <span class=\"k\">import</span> <span class=\"n\">gradient_table</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.data</span> <span class=\"k\">import</span> <span class=\"n\">get_fnames</span><span class=\"p\">,</span> <span class=\"n\">default_sphere</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.direction</span> <span class=\"k\">import</span> <span class=\"n\">DeterministicMaximumDirectionGetter</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.io.gradients</span> <span class=\"k\">import</span> <span class=\"n\">read_bvals_bvecs</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.io.image</span> <span class=\"k\">import</span> <span class=\"n\">load_nifti</span><span class=\"p\">,</span> <span class=\"n\">load_nifti_data</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.io.streamline</span> <span class=\"k\">import</span> <span class=\"n\">save_trk</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.io.stateful_tractogram</span> <span class=\"k\">import</span> <span class=\"n\">Space</span><span class=\"p\">,</span> <span class=\"n\">StatefulTractogram</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.reconst.csdeconv</span> <span class=\"k\">import</span> <span class=\"p\">(</span><span class=\"n\">ConstrainedSphericalDeconvModel</span><span class=\"p\">,</span>\n                                   <span class=\"n\">auto_response_ssst</span><span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.reconst.dti</span> <span class=\"k\">import</span> <span class=\"n\">fractional_anisotropy</span><span class=\"p\">,</span> <span class=\"n\">TensorModel</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.tracking</span> <span class=\"k\">import</span> <span class=\"n\">utils</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.tracking.local_tracking</span> <span class=\"k\">import</span> <span class=\"n\">LocalTracking</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.tracking.streamline</span> <span class=\"k\">import</span> <span class=\"n\">Streamlines</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.tracking.stopping_criterion</span> <span class=\"k\">import</span> <span class=\"p\">(</span><span class=\"n\">ActStoppingCriterion</span><span class=\"p\">,</span>\n                                              <span class=\"n\">BinaryStoppingCriterion</span><span class=\"p\">,</span>\n                                              <span class=\"n\">ThresholdStoppingCriterion</span><span class=\"p\">)</span>\n<span class=\"kn\">from</span> <span class=\"nn\">dipy.viz</span> <span class=\"k\">import</span> <span class=\"n\">window</span><span class=\"p\">,</span> <span class=\"n\">actor</span><span class=\"p\">,</span> <span class=\"n\">colormap</span><span class=\"p\">,</span> <span class=\"n\">has_fury</span>\n\n\n<span class=\"c1\"># Enables/disables interactive visualization</span>\n<span class=\"n\">interactive</span> <span class=\"o\">=</span> <span class=\"kc\">False</span>\n\n<span class=\"n\">hardi_fname</span><span class=\"p\">,</span> <span class=\"n\">hardi_bval_fname</span><span class=\"p\">,</span> <span class=\"n\">hardi_bvec_fname</span> <span class=\"o\">=</span> <span class=\"n\">get_fnames</span><span class=\"p\">(</span><span class=\"s1\">&#39;stanford_hardi&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">label_fname</span> <span class=\"o\">=</span> <span class=\"n\">get_fnames</span><span class=\"p\">(</span><span class=\"s1\">&#39;stanford_labels&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">_</span><span class=\"p\">,</span> <span class=\"n\">f_pve_wm</span> <span class=\"o\">=</span> <span class=\"n\">get_fnames</span><span class=\"p\">(</span><span class=\"s1\">&#39;stanford_pve_maps&#39;</span><span class=\"p\">)</span>\n\n<span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">affine</span><span class=\"p\">,</span> <span class=\"n\">hardi_img</span> <span class=\"o\">=</span> <span class=\"n\">load_nifti</span><span class=\"p\">(</span><span class=\"n\">hardi_fname</span><span class=\"p\">,</span> <span class=\"n\">return_img</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n<span class=\"n\">labels</span> <span class=\"o\">=</span> <span class=\"n\">load_nifti_data</span><span class=\"p\">(</span><span class=\"n\">label_fname</span><span class=\"p\">)</span>\n<span class=\"n\">bvals</span><span class=\"p\">,</span> <span class=\"n\">bvecs</span> <span class=\"o\">=</span> <span class=\"n\">read_bvals_bvecs</span><span class=\"p\">(</span><span class=\"n\">hardi_bval_fname</span><span class=\"p\">,</span> <span class=\"n\">hardi_bvec_fname</span><span class=\"p\">)</span>\n<span class=\"n\">gtab</span> <span class=\"o\">=</span> <span class=\"n\">gradient_table</span><span class=\"p\">(</span><span class=\"n\">bvals</span><span class=\"p\">,</span> <span class=\"n\">bvecs</span><span class=\"p\">)</span>\n\n<span class=\"n\">white_matter</span> <span class=\"o\">=</span> <span class=\"n\">load_nifti_data</span><span class=\"p\">(</span><span class=\"n\">f_pve_wm</span><span class=\"p\">)</span>\n\n<span class=\"n\">seed_mask</span> <span class=\"o\">=</span> <span class=\"p\">(</span><span class=\"n\">labels</span> <span class=\"o\">==</span> <span class=\"mi\">2</span><span class=\"p\">)</span>\n<span class=\"n\">seed_mask</span><span class=\"p\">[</span><span class=\"n\">white_matter</span> <span class=\"o\">&lt;</span> <span class=\"mf\">0.5</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n<span class=\"n\">seeds</span> <span class=\"o\">=</span> <span class=\"n\">utils</span><span class=\"o\">.</span><span class=\"n\">seeds_from_mask</span><span class=\"p\">(</span><span class=\"n\">seed_mask</span><span class=\"p\">,</span> <span class=\"n\">affine</span><span class=\"p\">,</span> <span class=\"n\">density</span><span class=\"o\">=</span><span class=\"mi\">2</span><span class=\"p\">)</span>\n\n<span class=\"n\">response</span><span class=\"p\">,</span> <span class=\"n\">ratio</span> <span class=\"o\">=</span> <span class=\"n\">auto_response_ssst</span><span class=\"p\">(</span><span class=\"n\">gtab</span><span class=\"p\">,</span> <span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">roi_radii</span><span class=\"o\">=</span><span class=\"mi\">10</span><span class=\"p\">,</span> <span class=\"n\">fa_thr</span><span class=\"o\">=</span><span class=\"mf\">0.7</span><span class=\"p\">)</span>\n<span class=\"n\">csd_model</span> <span class=\"o\">=</span> <span class=\"n\">ConstrainedSphericalDeconvModel</span><span class=\"p\">(</span><span class=\"n\">gtab</span><span class=\"p\">,</span> <span class=\"n\">response</span><span class=\"p\">)</span>\n<span class=\"n\">csd_fit</span> <span class=\"o\">=</span> <span class=\"n\">csd_model</span><span class=\"o\">.</span><span class=\"n\">fit</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">mask</span><span class=\"o\">=</span><span class=\"n\">white_matter</span><span class=\"p\">)</span>\n\n<span class=\"n\">dg</span> <span class=\"o\">=</span> <span class=\"n\">DeterministicMaximumDirectionGetter</span><span class=\"o\">.</span><span class=\"n\">from_shcoeff</span><span class=\"p\">(</span><span class=\"n\">csd_fit</span><span class=\"o\">.</span><span class=\"n\">shm_coeff</span><span class=\"p\">,</span>\n                                                      <span class=\"n\">max_angle</span><span class=\"o\">=</span><span class=\"mf\">30.</span><span class=\"p\">,</span>\n                                                      <span class=\"n\">sphere</span><span class=\"o\">=</span><span class=\"n\">default_sphere</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<div class=\"section\" id=\"threshold-stopping-criterion\">\n<h2>Threshold Stopping Criterion<a class=\"headerlink\" href=\"#threshold-stopping-criterion\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>A scalar map can be used to define where the tracking stops. The threshold\nstopping criterion uses a scalar map to stop the tracking whenever the\ninterpolated scalar value is lower than a fixed threshold. Here, we show\nan example using the fractional anisotropy (FA) map of the DTI model.\nThe threshold stopping criterion uses a trilinear interpolation at the\ntracking position.</p>\n<p><strong>Parameters</strong></p>\n<ul class=\"simple\">\n<li><p>metric_map: numpy array [:, :, :]</p></li>\n<li><p>threshold: float</p></li>\n</ul>\n<p><strong>Stopping States</strong></p>\n<ul class=\"simple\">\n<li><p>\u2018ENDPOINT\u2019: stops at a position where metric_map &lt; threshold; the\nstreamline reached the target stopping area.</p></li>\n<li><p>\u2018OUTSIDEIMAGE\u2019: stops at a position outside of metric_map; the streamline\nreached an area outside the image where no direction data is available.</p></li>\n<li><p>\u2018TRACKPOINT\u2019: stops at a position because no direction is available; the\nstreamline is stopping where metric_map &gt;= threshold, but there is no valid\ndirection to follow.</p></li>\n<li><p>\u2018INVALIDPOINT\u2019: N/A.</p></li>\n</ul>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">tensor_model</span> <span class=\"o\">=</span> <span class=\"n\">TensorModel</span><span class=\"p\">(</span><span class=\"n\">gtab</span><span class=\"p\">)</span>\n<span class=\"n\">tenfit</span> <span class=\"o\">=</span> <span class=\"n\">tensor_model</span><span class=\"o\">.</span><span class=\"n\">fit</span><span class=\"p\">(</span><span class=\"n\">data</span><span class=\"p\">,</span> <span class=\"n\">mask</span><span class=\"o\">=</span><span class=\"n\">labels</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">)</span>\n<span class=\"n\">FA</span> <span class=\"o\">=</span> <span class=\"n\">fractional_anisotropy</span><span class=\"p\">(</span><span class=\"n\">tenfit</span><span class=\"o\">.</span><span class=\"n\">evals</span><span class=\"p\">)</span>\n\n<span class=\"n\">threshold_criterion</span> <span class=\"o\">=</span> <span class=\"n\">ThresholdStoppingCriterion</span><span class=\"p\">(</span><span class=\"n\">FA</span><span class=\"p\">,</span> <span class=\"o\">.</span><span class=\"mi\">2</span><span class=\"p\">)</span>\n\n<span class=\"n\">fig</span> <span class=\"o\">=</span> <span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">figure</span><span class=\"p\">()</span>\n<span class=\"n\">mask_fa</span> <span class=\"o\">=</span> <span class=\"n\">FA</span><span class=\"o\">.</span><span class=\"n\">copy</span><span class=\"p\">()</span>\n<span class=\"n\">mask_fa</span><span class=\"p\">[</span><span class=\"n\">mask_fa</span> <span class=\"o\">&lt;</span> <span class=\"mf\">0.2</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">xticks</span><span class=\"p\">([])</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">yticks</span><span class=\"p\">([])</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">imshow</span><span class=\"p\">(</span><span class=\"n\">mask_fa</span><span class=\"p\">[:,</span> <span class=\"p\">:,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]</span> <span class=\"o\">//</span> <span class=\"mi\">2</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">T</span><span class=\"p\">,</span> <span class=\"n\">cmap</span><span class=\"o\">=</span><span class=\"s1\">&#39;gray&#39;</span><span class=\"p\">,</span> <span class=\"n\">origin</span><span class=\"o\">=</span><span class=\"s1\">&#39;lower&#39;</span><span class=\"p\">,</span>\n           <span class=\"n\">interpolation</span><span class=\"o\">=</span><span class=\"s1\">&#39;nearest&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">fig</span><span class=\"o\">.</span><span class=\"n\">tight_layout</span><span class=\"p\">()</span>\n<span class=\"n\">fig</span><span class=\"o\">.</span><span class=\"n\">savefig</span><span class=\"p\">(</span><span class=\"s1\">&#39;threshold_fa.png&#39;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img alt=\"tracking stopping criterion\" class=\"sphx-glr-single-img\" src=\"../../../_images/sphx_glr_tracking_stopping_criterion_001.png\" />\n<div class=\"figure align-center\" id=\"id5\">\n<img alt=\"examples_built/fiber_tracking/threshold_fa.png\" src=\"examples_built/fiber_tracking/threshold_fa.png\" />\n<p class=\"caption\"><span class=\"caption-text\"><strong>Thresholded fractional anisotropy map.</strong></span><a class=\"headerlink\" href=\"#id5\" title=\"Permalink to this image\">\u00b6</a></p>\n</div>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">streamline_generator</span> <span class=\"o\">=</span> <span class=\"n\">LocalTracking</span><span class=\"p\">(</span><span class=\"n\">dg</span><span class=\"p\">,</span>\n                                     <span class=\"n\">threshold_criterion</span><span class=\"p\">,</span>\n                                     <span class=\"n\">seeds</span><span class=\"p\">,</span>\n                                     <span class=\"n\">affine</span><span class=\"p\">,</span>\n                                     <span class=\"n\">step_size</span><span class=\"o\">=.</span><span class=\"mi\">5</span><span class=\"p\">,</span>\n                                     <span class=\"n\">return_all</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n<span class=\"n\">streamlines</span> <span class=\"o\">=</span> <span class=\"n\">Streamlines</span><span class=\"p\">(</span><span class=\"n\">streamline_generator</span><span class=\"p\">)</span>\n<span class=\"n\">sft</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">streamlines</span><span class=\"p\">,</span> <span class=\"n\">hardi_img</span><span class=\"p\">,</span> <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">sft</span><span class=\"p\">,</span> <span class=\"s2\">&quot;tractogram_probabilistic_thresh_all.trk&quot;</span><span class=\"p\">)</span>\n\n<span class=\"k\">if</span> <span class=\"n\">has_fury</span><span class=\"p\">:</span>\n    <span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n    <span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">streamlines</span><span class=\"p\">,</span> <span class=\"n\">colormap</span><span class=\"o\">.</span><span class=\"n\">line_colors</span><span class=\"p\">(</span><span class=\"n\">streamlines</span><span class=\"p\">)))</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;tractogram_deterministic_thresh_all.png&#39;</span><span class=\"p\">,</span>\n                  <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">800</span><span class=\"p\">,</span> <span class=\"mi\">800</span><span class=\"p\">))</span>\n    <span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n        <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img alt=\"tracking stopping criterion\" class=\"sphx-glr-single-img\" src=\"../../../_images/sphx_glr_tracking_stopping_criterion_002.png\" />\n<p class=\"sphx-glr-script-out\">Out:</p>\n<div class=\"sphx-glr-script-out highlight-none notranslate\"><div class=\"highlight\"><pre><span></span>/Users/koudoro/miniconda3/envs/dipy-env-37/lib/python3.7/site-packages/vtkmodules/util/numpy_support.py:66: DeprecationWarning: Converting `np.character` to a dtype is deprecated. The current result is `np.dtype(np.str_)` which is not strictly correct. Note that `np.character` is generally deprecated and &#39;S1&#39; should be used.\n  if numpy_array_type == key or \\\n/Users/koudoro/miniconda3/envs/dipy-env-37/lib/python3.7/site-packages/vtkmodules/util/numpy_support.py:68: DeprecationWarning: Converting `np.character` to a dtype is deprecated. The current result is `np.dtype(np.str_)` which is not strictly correct. Note that `np.character` is generally deprecated and &#39;S1&#39; should be used.\n  numpy_array_type == numpy.dtype(key):\n/Users/koudoro/miniconda3/envs/dipy-env-37/lib/python3.7/site-packages/fury/utils.py:97: VisibleDeprecationWarning: Creating an ndarray from ragged nested sequences (which is a list-or-tuple of lists-or-tuples-or ndarrays with different lengths or shapes) is deprecated. If you meant to do this, you must specify &#39;dtype=object&#39; when creating the ndarray\n  data = np.array(data)\n</pre></div>\n</div>\n<div class=\"figure align-center\" id=\"id6\">\n<img alt=\"examples_built/fiber_tracking/tractogram_deterministic_thresh_all.png\" src=\"examples_built/fiber_tracking/tractogram_deterministic_thresh_all.png\" />\n<p class=\"caption\"><span class=\"caption-text\"><strong>Corpus Callosum using deterministic tractography with a thresholded\nfractional anisotropy mask.</strong></span><a class=\"headerlink\" href=\"#id6\" title=\"Permalink to this image\">\u00b6</a></p>\n</div>\n</div>\n<div class=\"section\" id=\"binary-stopping-criterion\">\n<h2>Binary Stopping Criterion<a class=\"headerlink\" href=\"#binary-stopping-criterion\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>A binary mask can be used to define where the tracking stops. The binary\nstopping criterion stops the tracking whenever the tracking position is\noutside the mask. Here, we show how to obtain the binary stopping criterion\nfrom the white matter mask defined above. The binary stopping criterion uses\na nearest-neighborhood interpolation at the tracking position.</p>\n<p><strong>Parameters</strong></p>\n<ul class=\"simple\">\n<li><p>mask: numpy array [:, :, :]</p></li>\n</ul>\n<p><strong>Stopping States</strong></p>\n<ul class=\"simple\">\n<li><p>\u2018ENDPOINT\u2019: stops at a position where mask = 0; the streamline\nreached the target stopping area.</p></li>\n<li><p>\u2018OUTSIDEIMAGE\u2019: stops at a position outside of metric_map; the streamline\nreached an area outside the image where no direction data is available.</p></li>\n<li><p>\u2018TRACKPOINT\u2019: stops at a position because no direction is available; the\nstreamline is stopping where mask &gt; 0, but there is no valid direction to\nfollow.</p></li>\n<li><p>\u2018INVALIDPOINT\u2019: N/A.</p></li>\n</ul>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">binary_criterion</span> <span class=\"o\">=</span> <span class=\"n\">BinaryStoppingCriterion</span><span class=\"p\">(</span><span class=\"n\">white_matter</span> <span class=\"o\">==</span> <span class=\"mi\">1</span><span class=\"p\">)</span>\n\n<span class=\"n\">fig</span> <span class=\"o\">=</span> <span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">figure</span><span class=\"p\">()</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">xticks</span><span class=\"p\">([])</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">yticks</span><span class=\"p\">([])</span>\n<span class=\"n\">fig</span><span class=\"o\">.</span><span class=\"n\">tight_layout</span><span class=\"p\">()</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">imshow</span><span class=\"p\">(</span><span class=\"n\">white_matter</span><span class=\"p\">[:,</span> <span class=\"p\">:,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]</span> <span class=\"o\">//</span> <span class=\"mi\">2</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">T</span><span class=\"p\">,</span> <span class=\"n\">cmap</span><span class=\"o\">=</span><span class=\"s1\">&#39;gray&#39;</span><span class=\"p\">,</span>\n           <span class=\"n\">origin</span><span class=\"o\">=</span><span class=\"s1\">&#39;lower&#39;</span><span class=\"p\">,</span> <span class=\"n\">interpolation</span><span class=\"o\">=</span><span class=\"s1\">&#39;nearest&#39;</span><span class=\"p\">)</span>\n\n<span class=\"n\">fig</span><span class=\"o\">.</span><span class=\"n\">savefig</span><span class=\"p\">(</span><span class=\"s1\">&#39;white_matter_mask.png&#39;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img alt=\"tracking stopping criterion\" class=\"sphx-glr-single-img\" src=\"../../../_images/sphx_glr_tracking_stopping_criterion_003.png\" />\n<div class=\"figure align-center\" id=\"id7\">\n<img alt=\"examples_built/fiber_tracking/white_matter_mask.png\" src=\"examples_built/fiber_tracking/white_matter_mask.png\" />\n<p class=\"caption\"><span class=\"caption-text\"><strong>White matter binary mask.</strong></span><a class=\"headerlink\" href=\"#id7\" title=\"Permalink to this image\">\u00b6</a></p>\n</div>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">streamline_generator</span> <span class=\"o\">=</span> <span class=\"n\">LocalTracking</span><span class=\"p\">(</span><span class=\"n\">dg</span><span class=\"p\">,</span>\n                                     <span class=\"n\">binary_criterion</span><span class=\"p\">,</span>\n                                     <span class=\"n\">seeds</span><span class=\"p\">,</span>\n                                     <span class=\"n\">affine</span><span class=\"p\">,</span>\n                                     <span class=\"n\">step_size</span><span class=\"o\">=.</span><span class=\"mi\">5</span><span class=\"p\">,</span>\n                                     <span class=\"n\">return_all</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n<span class=\"n\">streamlines</span> <span class=\"o\">=</span> <span class=\"n\">Streamlines</span><span class=\"p\">(</span><span class=\"n\">streamline_generator</span><span class=\"p\">)</span>\n<span class=\"n\">sft</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">streamlines</span><span class=\"p\">,</span> <span class=\"n\">hardi_img</span><span class=\"p\">,</span> <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">sft</span><span class=\"p\">,</span> <span class=\"s2\">&quot;tractogram_deterministic_binary_all.trk&quot;</span><span class=\"p\">)</span>\n\n<span class=\"k\">if</span> <span class=\"n\">has_fury</span><span class=\"p\">:</span>\n    <span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n    <span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">streamlines</span><span class=\"p\">,</span> <span class=\"n\">colormap</span><span class=\"o\">.</span><span class=\"n\">line_colors</span><span class=\"p\">(</span><span class=\"n\">streamlines</span><span class=\"p\">)))</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;tractogram_deterministic_binary_all.png&#39;</span><span class=\"p\">,</span>\n                  <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">800</span><span class=\"p\">,</span> <span class=\"mi\">800</span><span class=\"p\">))</span>\n    <span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n        <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img alt=\"tracking stopping criterion\" class=\"sphx-glr-single-img\" src=\"../../../_images/sphx_glr_tracking_stopping_criterion_004.png\" />\n<div class=\"figure align-center\" id=\"id8\">\n<img alt=\"examples_built/fiber_tracking/tractogram_deterministic_binary_all.png\" src=\"examples_built/fiber_tracking/tractogram_deterministic_binary_all.png\" />\n<p class=\"caption\"><span class=\"caption-text\"><strong>Corpus Callosum using deterministic tractography with a binary white\nmatter mask.</strong></span><a class=\"headerlink\" href=\"#id8\" title=\"Permalink to this image\">\u00b6</a></p>\n</div>\n</div>\n<div class=\"section\" id=\"act-stopping-criterion\">\n<h2>ACT Stopping Criterion<a class=\"headerlink\" href=\"#act-stopping-criterion\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>Anatomically-constrained tractography (ACT) <a class=\"reference internal\" href=\"../../tracking_stopping_criterion/#smith2012\" id=\"id3\"><span>[Smith2012]</span></a> uses information\nfrom anatomical images to determine when the tractography stops. The\n<code class=\"docutils literal notranslate\"><span class=\"pre\">include_map</span></code> defines when the streamline reached a \u2018valid\u2019 stopping region\n(e.g. gray matter partial volume estimation (PVE) map) and the\n<code class=\"docutils literal notranslate\"><span class=\"pre\">exclude_map</span></code> defines when the streamline reached an \u2018invalid\u2019 stopping\nregion (e.g. corticospinal fluid PVE map). The background of the anatomical\nimage should be added to the <code class=\"docutils literal notranslate\"><span class=\"pre\">include_map</span></code> to keep streamlines exiting the\nbrain (e.g. through the brain stem). The ACT stopping criterion uses a\ntrilinear interpolation at the tracking position.</p>\n<p><strong>Parameters</strong></p>\n<ul class=\"simple\">\n<li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">include_map</span></code>: numpy array <code class=\"docutils literal notranslate\"><span class=\"pre\">[:,</span> <span class=\"pre\">:,</span> <span class=\"pre\">:]</span></code>,</p></li>\n<li><p><code class=\"docutils literal notranslate\"><span class=\"pre\">exclude_map</span></code>: numpy array <code class=\"docutils literal notranslate\"><span class=\"pre\">[:,</span> <span class=\"pre\">:,</span> <span class=\"pre\">:]</span></code>,</p></li>\n</ul>\n<p><strong>Stopping States</strong></p>\n<ul class=\"simple\">\n<li><p>\u2018ENDPOINT\u2019: stops at a position where <code class=\"docutils literal notranslate\"><span class=\"pre\">include_map</span></code> &gt; 0.5; the streamline\nreached the target stopping area.</p></li>\n<li><p>\u2018OUTSIDEIMAGE\u2019: stops at a position outside of <code class=\"docutils literal notranslate\"><span class=\"pre\">include_map</span></code> or\n<code class=\"docutils literal notranslate\"><span class=\"pre\">exclude_map</span></code>; the streamline reached an area outside the image where no\ndirection data is available.</p></li>\n<li><p>\u2018TRACKPOINT\u2019: stops at a position because no direction is available; the\nstreamline is stopping where <code class=\"docutils literal notranslate\"><span class=\"pre\">include_map</span></code> &lt; 0.5 and\n<code class=\"docutils literal notranslate\"><span class=\"pre\">exclude_map</span></code> &lt; 0.5, but there is no valid direction to follow.</p></li>\n<li><p>\u2018INVALIDPOINT\u2019: <code class=\"docutils literal notranslate\"><span class=\"pre\">exclude_map</span></code> &gt; 0.5; the streamline reach a position\nwhich is anatomically not plausible.</p></li>\n</ul>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">f_pve_csf</span><span class=\"p\">,</span> <span class=\"n\">f_pve_gm</span><span class=\"p\">,</span> <span class=\"n\">f_pve_wm</span> <span class=\"o\">=</span> <span class=\"n\">get_fnames</span><span class=\"p\">(</span><span class=\"s1\">&#39;stanford_pve_maps&#39;</span><span class=\"p\">)</span>\n<span class=\"n\">pve_csf_data</span> <span class=\"o\">=</span> <span class=\"n\">load_nifti_data</span><span class=\"p\">(</span><span class=\"n\">f_pve_csf</span><span class=\"p\">)</span>\n<span class=\"n\">pve_gm_data</span> <span class=\"o\">=</span> <span class=\"n\">load_nifti_data</span><span class=\"p\">(</span><span class=\"n\">f_pve_gm</span><span class=\"p\">)</span>\n<span class=\"n\">pve_wm_data</span> <span class=\"o\">=</span> <span class=\"n\">load_nifti_data</span><span class=\"p\">(</span><span class=\"n\">f_pve_wm</span><span class=\"p\">)</span>\n\n<span class=\"n\">background</span> <span class=\"o\">=</span> <span class=\"n\">np</span><span class=\"o\">.</span><span class=\"n\">ones</span><span class=\"p\">(</span><span class=\"n\">pve_gm_data</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">)</span>\n<span class=\"n\">background</span><span class=\"p\">[(</span><span class=\"n\">pve_gm_data</span> <span class=\"o\">+</span> <span class=\"n\">pve_wm_data</span> <span class=\"o\">+</span> <span class=\"n\">pve_csf_data</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">0</span>\n\n<span class=\"n\">include_map</span> <span class=\"o\">=</span> <span class=\"n\">pve_gm_data</span>\n<span class=\"n\">include_map</span><span class=\"p\">[</span><span class=\"n\">background</span> <span class=\"o\">&gt;</span> <span class=\"mi\">0</span><span class=\"p\">]</span> <span class=\"o\">=</span> <span class=\"mi\">1</span>\n<span class=\"n\">exclude_map</span> <span class=\"o\">=</span> <span class=\"n\">pve_csf_data</span>\n\n<span class=\"n\">act_criterion</span> <span class=\"o\">=</span> <span class=\"n\">ActStoppingCriterion</span><span class=\"p\">(</span><span class=\"n\">include_map</span><span class=\"p\">,</span> <span class=\"n\">exclude_map</span><span class=\"p\">)</span>\n\n<span class=\"n\">fig</span> <span class=\"o\">=</span> <span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">figure</span><span class=\"p\">()</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">subplot</span><span class=\"p\">(</span><span class=\"mi\">121</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">xticks</span><span class=\"p\">([])</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">yticks</span><span class=\"p\">([])</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">imshow</span><span class=\"p\">(</span><span class=\"n\">include_map</span><span class=\"p\">[:,</span> <span class=\"p\">:,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]</span> <span class=\"o\">//</span> <span class=\"mi\">2</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">T</span><span class=\"p\">,</span> <span class=\"n\">cmap</span><span class=\"o\">=</span><span class=\"s1\">&#39;gray&#39;</span><span class=\"p\">,</span>\n           <span class=\"n\">origin</span><span class=\"o\">=</span><span class=\"s1\">&#39;lower&#39;</span><span class=\"p\">,</span> <span class=\"n\">interpolation</span><span class=\"o\">=</span><span class=\"s1\">&#39;nearest&#39;</span><span class=\"p\">)</span>\n\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">subplot</span><span class=\"p\">(</span><span class=\"mi\">122</span><span class=\"p\">)</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">xticks</span><span class=\"p\">([])</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">yticks</span><span class=\"p\">([])</span>\n<span class=\"n\">plt</span><span class=\"o\">.</span><span class=\"n\">imshow</span><span class=\"p\">(</span><span class=\"n\">exclude_map</span><span class=\"p\">[:,</span> <span class=\"p\">:,</span> <span class=\"n\">data</span><span class=\"o\">.</span><span class=\"n\">shape</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]</span> <span class=\"o\">//</span> <span class=\"mi\">2</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">T</span><span class=\"p\">,</span> <span class=\"n\">cmap</span><span class=\"o\">=</span><span class=\"s1\">&#39;gray&#39;</span><span class=\"p\">,</span>\n           <span class=\"n\">origin</span><span class=\"o\">=</span><span class=\"s1\">&#39;lower&#39;</span><span class=\"p\">,</span> <span class=\"n\">interpolation</span><span class=\"o\">=</span><span class=\"s1\">&#39;nearest&#39;</span><span class=\"p\">)</span>\n\n<span class=\"n\">fig</span><span class=\"o\">.</span><span class=\"n\">tight_layout</span><span class=\"p\">()</span>\n<span class=\"n\">fig</span><span class=\"o\">.</span><span class=\"n\">savefig</span><span class=\"p\">(</span><span class=\"s1\">&#39;act_maps.png&#39;</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img alt=\"tracking stopping criterion\" class=\"sphx-glr-single-img\" src=\"../../../_images/sphx_glr_tracking_stopping_criterion_005.png\" />\n<div class=\"figure align-center\" id=\"id9\">\n<img alt=\"examples_built/fiber_tracking/act_maps.png\" src=\"examples_built/fiber_tracking/act_maps.png\" />\n<p class=\"caption\"><span class=\"caption-text\"><strong>Include (left) and exclude (right) maps for ACT.</strong></span><a class=\"headerlink\" href=\"#id9\" title=\"Permalink to this image\">\u00b6</a></p>\n</div>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">streamline_generator</span> <span class=\"o\">=</span> <span class=\"n\">LocalTracking</span><span class=\"p\">(</span><span class=\"n\">dg</span><span class=\"p\">,</span>\n                                     <span class=\"n\">act_criterion</span><span class=\"p\">,</span>\n                                     <span class=\"n\">seeds</span><span class=\"p\">,</span>\n                                     <span class=\"n\">affine</span><span class=\"p\">,</span>\n                                     <span class=\"n\">step_size</span><span class=\"o\">=.</span><span class=\"mi\">5</span><span class=\"p\">,</span>\n                                     <span class=\"n\">return_all</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n<span class=\"n\">streamlines</span> <span class=\"o\">=</span> <span class=\"n\">Streamlines</span><span class=\"p\">(</span><span class=\"n\">streamline_generator</span><span class=\"p\">)</span>\n<span class=\"n\">sft</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">streamlines</span><span class=\"p\">,</span> <span class=\"n\">hardi_img</span><span class=\"p\">,</span> <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">sft</span><span class=\"p\">,</span> <span class=\"s2\">&quot;tractogram_deterministic_act_all.trk&quot;</span><span class=\"p\">)</span>\n\n<span class=\"k\">if</span> <span class=\"n\">has_fury</span><span class=\"p\">:</span>\n    <span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n    <span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">streamlines</span><span class=\"p\">,</span> <span class=\"n\">colormap</span><span class=\"o\">.</span><span class=\"n\">line_colors</span><span class=\"p\">(</span><span class=\"n\">streamlines</span><span class=\"p\">)))</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;tractogram_deterministic_act_all.png&#39;</span><span class=\"p\">,</span>\n                  <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">800</span><span class=\"p\">,</span> <span class=\"mi\">800</span><span class=\"p\">))</span>\n    <span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n        <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img alt=\"tracking stopping criterion\" class=\"sphx-glr-single-img\" src=\"../../../_images/sphx_glr_tracking_stopping_criterion_006.png\" />\n<div class=\"figure align-center\" id=\"id10\">\n<img alt=\"examples_built/fiber_tracking/tractogram_deterministic_act_all.png\" src=\"examples_built/fiber_tracking/tractogram_deterministic_act_all.png\" />\n<p class=\"caption\"><span class=\"caption-text\"><strong>Corpus Callosum using deterministic tractography with ACT stopping\ncriterion.</strong></span><a class=\"headerlink\" href=\"#id10\" title=\"Permalink to this image\">\u00b6</a></p>\n</div>\n<div class=\"highlight-default notranslate\"><div class=\"highlight\"><pre><span></span><span class=\"n\">streamline_generator</span> <span class=\"o\">=</span> <span class=\"n\">LocalTracking</span><span class=\"p\">(</span><span class=\"n\">dg</span><span class=\"p\">,</span>\n                                     <span class=\"n\">act_criterion</span><span class=\"p\">,</span>\n                                     <span class=\"n\">seeds</span><span class=\"p\">,</span>\n                                     <span class=\"n\">affine</span><span class=\"p\">,</span>\n                                     <span class=\"n\">step_size</span><span class=\"o\">=.</span><span class=\"mi\">5</span><span class=\"p\">,</span>\n                                     <span class=\"n\">return_all</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">)</span>\n<span class=\"n\">streamlines</span> <span class=\"o\">=</span> <span class=\"n\">Streamlines</span><span class=\"p\">(</span><span class=\"n\">streamline_generator</span><span class=\"p\">)</span>\n<span class=\"n\">sft</span> <span class=\"o\">=</span> <span class=\"n\">StatefulTractogram</span><span class=\"p\">(</span><span class=\"n\">streamlines</span><span class=\"p\">,</span> <span class=\"n\">hardi_img</span><span class=\"p\">,</span> <span class=\"n\">Space</span><span class=\"o\">.</span><span class=\"n\">RASMM</span><span class=\"p\">)</span>\n<span class=\"n\">save_trk</span><span class=\"p\">(</span><span class=\"n\">sft</span><span class=\"p\">,</span> <span class=\"s2\">&quot;tractogram_deterministic_act_valid.trk&quot;</span><span class=\"p\">)</span>\n\n<span class=\"k\">if</span> <span class=\"n\">has_fury</span><span class=\"p\">:</span>\n    <span class=\"n\">scene</span> <span class=\"o\">=</span> <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">Scene</span><span class=\"p\">()</span>\n    <span class=\"n\">scene</span><span class=\"o\">.</span><span class=\"n\">add</span><span class=\"p\">(</span><span class=\"n\">actor</span><span class=\"o\">.</span><span class=\"n\">line</span><span class=\"p\">(</span><span class=\"n\">streamlines</span><span class=\"p\">,</span> <span class=\"n\">colormap</span><span class=\"o\">.</span><span class=\"n\">line_colors</span><span class=\"p\">(</span><span class=\"n\">streamlines</span><span class=\"p\">)))</span>\n    <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">record</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">,</span> <span class=\"n\">out_path</span><span class=\"o\">=</span><span class=\"s1\">&#39;tractogram_deterministic_act_valid.png&#39;</span><span class=\"p\">,</span>\n                  <span class=\"n\">size</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"mi\">800</span><span class=\"p\">,</span> <span class=\"mi\">800</span><span class=\"p\">))</span>\n    <span class=\"k\">if</span> <span class=\"n\">interactive</span><span class=\"p\">:</span>\n        <span class=\"n\">window</span><span class=\"o\">.</span><span class=\"n\">show</span><span class=\"p\">(</span><span class=\"n\">scene</span><span class=\"p\">)</span>\n</pre></div>\n</div>\n<img alt=\"tracking stopping criterion\" class=\"sphx-glr-single-img\" src=\"../../../_images/sphx_glr_tracking_stopping_criterion_007.png\" />\n<div class=\"figure align-center\" id=\"id11\">\n<img alt=\"examples_built/fiber_tracking/tractogram_deterministic_act_valid.png\" src=\"examples_built/fiber_tracking/tractogram_deterministic_act_valid.png\" />\n<p class=\"caption\"><span class=\"caption-text\"><strong>Corpus Callosum using deterministic tractography with ACT stopping\ncriterion. Streamlines ending in gray matter region only.</strong></span><a class=\"headerlink\" href=\"#id11\" title=\"Permalink to this image\">\u00b6</a></p>\n</div>\n<p>The threshold and binary stopping criterion use respectively a scalar map\nand a binary mask to stop the tracking. The ACT stopping criterion use\npartial volume fraction (PVE) maps from an anatomical image to stop the\ntracking. Additionally, the ACT stopping criterion determines if the\ntracking stopped in expected regions (e.g. gray matter) and allows the user\nto get only streamlines stopping in those regions.</p>\n<div class=\"section\" id=\"notes\">\n<h3>Notes<a class=\"headerlink\" href=\"#notes\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>Currently,the proposed method that cuts streamlines going through\nsubcortical gray matter regions is not implemented. The\nbacktracking technique for streamlines reaching INVALIDPOINT is not\nimplemented either <a class=\"reference internal\" href=\"../../tracking_stopping_criterion/#smith2012\" id=\"id4\"><span>[Smith2012]</span></a>.</p>\n</div>\n<div class=\"section\" id=\"references\">\n<h3>References<a class=\"headerlink\" href=\"#references\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<dl class=\"citation\">\n<dt class=\"label\" id=\"smith2012\"><span class=\"brackets\">Smith2012</span><span class=\"fn-backref\">(<a href=\"#id2\">1</a>,<a href=\"#id3\">2</a>,<a href=\"#id4\">3</a>)</span></dt>\n<dd><p>Smith, R. E., Tournier, J.-D., Calamante, F., &amp; Connelly, A.\nAnatomically-constrained tractography: Improved diffusion MRI\nstreamlines tractography through effective use of anatomical\ninformation. NeuroImage, 63(3), 1924-1938, 2012.</p>\n</dd>\n<dt class=\"label\" id=\"girard2014\"><span class=\"brackets\"><a class=\"fn-backref\" href=\"#id1\">Girard2014</a></span></dt>\n<dd><p>Girard, G., Whittingstall, K., Deriche, R., &amp; Descoteaux, M.\nTowards quantitative connectivity analysis: reducing tractography biases.\nNeuroImage, 98, 266-278, 2014.</p>\n</dd>\n</dl>\n<p class=\"sphx-glr-timing\"><strong>Total running time of the script:</strong> ( 1 minutes  49.973 seconds)</p>\n<div class=\"sphx-glr-footer class sphx-glr-footer-example docutils container\" id=\"sphx-glr-download-examples-built-fiber-tracking-tracking-stopping-criterion-py\">\n<div class=\"sphx-glr-download sphx-glr-download-python docutils container\">\n<p><a class=\"reference download internal\" download=\"\" href=\"../../../_downloads/e23998ab3459044f463f2ded46dec294/tracking_stopping_criterion.py\"><code class=\"xref download docutils literal notranslate\"><span class=\"pre\">Download</span> <span class=\"pre\">Python</span> <span class=\"pre\">source</span> <span class=\"pre\">code:</span> <span class=\"pre\">tracking_stopping_criterion.py</span></code></a></p>\n</div>\n<div class=\"sphx-glr-download sphx-glr-download-jupyter docutils container\">\n<p><a class=\"reference download internal\" download=\"\" href=\"../../../_downloads/c647ff2e080021d4296d0e10243cc4a4/tracking_stopping_criterion.ipynb\"><code class=\"xref download docutils literal notranslate\"><span class=\"pre\">Download</span> <span class=\"pre\">Jupyter</span> <span class=\"pre\">notebook:</span> <span class=\"pre\">tracking_stopping_criterion.ipynb</span></code></a></p>\n</div>\n</div>\n<p class=\"sphx-glr-signature\"><a class=\"reference external\" href=\"https://sphinx-gallery.github.io\">Gallery generated by Sphinx-Gallery</a></p>\n</div>\n</div>\n</div>\n", "metatags": "", "rellinks": [["genindex", "General Index", "I", "index"], ["py-modindex", "Python Module Index", "", "modules"]], "sourcename": "examples_built/fiber_tracking/tracking_stopping_criterion.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Using Various Stopping Criterion for Tractography</a><ul>\n<li><a class=\"reference internal\" href=\"#threshold-stopping-criterion\">Threshold Stopping Criterion</a></li>\n<li><a class=\"reference internal\" href=\"#binary-stopping-criterion\">Binary Stopping Criterion</a></li>\n<li><a class=\"reference internal\" href=\"#act-stopping-criterion\">ACT Stopping Criterion</a><ul>\n<li><a class=\"reference internal\" href=\"#notes\">Notes</a></li>\n<li><a class=\"reference internal\" href=\"#references\">References</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".rst", "current_page_name": "examples_built/fiber_tracking/tracking_stopping_criterion", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12"}